<head>
  <script>
    const checkSession = async (sessionId) => {
      // სესსიის გადამოწმება, გაიარა თუ არა სტეპზე ვალიდაცია
      const data = await fetch(`/check-session/${sessionId}`)
      const body = await data.json()
      return JSON.parse(body)
    }

    const nextAction = ({ details: { faceMatched, livenessStatus, documentValid } }) => {
      // ამოწმებს თუ წარმატებით მოხდა გავლა ამისამართებს შემდეგ სტეპზე
      if (faceMatched && !livenessStatus && documentValid) {
        const frame = document.getElementById('myFrame')
        frame.remove()

        const p = document.createElement("p")
        p.innerHTML = "success"
        document.body.appendChild(p)
      }
    }
    window.addEventListener('message', async event => {
      console.log("TCL: event", event.data)
      if (event.data.finished) {
        // event.data.sessionId is session Id
        const body = await checkSession(event.data.sessionId)
        nextAction(body)
      }
      if (event.data.isLivenessFinished) {
        // do something about liveness
      } else {
        // ...
      }
      if (event.data.isDocumentFinished) {
        // event.data.documentType returns enum type 'ID' or 'PASSPORT'
      } else {
        //...
      }

    }); 
  </script>
</head>

<body style="width: 100%; height: 100%;">
  <iframe id='myFrame' src="https://pasha.demo.kyc.ge/" allow="camera" width="80%" height="80%">

  </iframe>
</body>