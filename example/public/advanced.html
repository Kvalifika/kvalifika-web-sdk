<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>

    /* 
       Liveness step only. document will be skipped
       !! Note. documentType can also take 0, 1, 2. it controlls whats get shown to end user on document selection step
       0 - Both ID and PASSPORT will be shown
       1 - Only ID will be shown 
       2 - Only passport will be shown
       3 - Hide document step.
    */
    let options = {
      livenessType: 0,  //  0 - 3D , 1 - 2D  , 
      documentType: 3,
      kvalifikaDocument: true,
    }

    /* 
       Kvalifika document step with 3D liveness type.
    */
    options = {
      kvalifikaDocument: true,
      livenessType: 0,
    }


    /* 
       Kvalifika document step with 2D liveness type.
    */
    options = {
      kvalifikaDocument: true,
      livenessType: 1,
    }

    /* 
       Kvalifika document step with Liveness First session direction.
    */
    options = {
      kvalifikaDocument: true,
      livenessType: 1,
      sessionFlow: 0,
    }

    /* 
       Kvalifika document step with document First session direction
    */
    options = {
      kvalifikaDocument: true,
      livenessType: 1,
      sessionFlow: 1,
    }

    /* 
       Session with custom callbacks.
       Redirects user to success callback url if session finishes successfully
       Redirects user to error callback url if session fails.
    */
    options = {
      successCallbackUrl: '<>',
      errorCallbackUrl: '<>'
    }

    /* 
      Session with custom language.
      Available language inputs en | ge | ru | sp
    */
    options = {
      lang: 'en' 
    }

    /* 
      Hides first page
    */
    options = {
      isFirstPageShown: false
    }

    /* 
      Kvalifika document with only file upload.
      documentCaptureType allows client to controll what to show to end user.
      for instance allow user to use default browser camera for taking document pictures, or allow file upload, or native
      camera picker
    */
    options = {
      kvalifikaDocument: true,
      documentCaptureType: 2
    }

    /* 
      Optional data fields can be passed as extras. That will show up in admin panel
      All the keys in extra object needs to be listed in extra section. see admin panel => extras.
      For security if different extra field is provided it wont be saved.
    */
    const extras = {
      phoneNumber:'130000',
      personalNumber:'13000000'
    }

    const generateVerification = async () => {
      const { data } = await axios({
        url: 'https://api.kyc.ge/verification/generate',
        method: 'POST',
        data: {
          appId: 'O4ux3V66iFRVwOSQey_',
          options,
        },
        headers: {
          domain: 'lb.ge'
        }
      })



      const iframe = document.createElement("iframe");
      iframe.setAttribute("id", "kvalifikaIframe");
      iframe.setAttribute("src", `${data.url}`);
      iframe.setAttribute("style", "width: 100vw; height: 100vh");
      iframe.setAttribute("allow", "camera");
      iframe.setAttribute("allowfullscreen", true);
      iframe.setAttribute("scrolling", "yes");
      
      const container = document.querySelector("#kvalifika-iframe-container");
      container.appendChild(iframe);
    };


    generateVerification();
  </script>
</head>

<body>
  <!-- ხდება ფრეიმით ჩატვირთვა აპლიკაციის -->
  <div id="kvalifika-iframe-container"></div>

</body>

<script>
  function handleMessage() {
    console.log("Event", event.data['task'])
    // Scrol top event sample
    if (event.data['task'] == 'scroll_top'){
      window.scrollTo(0, 0);
    }
  }
   window.addEventListener("message", handleMessage, false);
</script>

</html>
